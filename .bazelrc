# Copyright 2020 The Mesh Authors. All rights reserved.
# Use of this source code is governed by the Apache License,
# Version 2.0, that can be found in the LICENSE file.

build --cxxopt='-std=c++17'
#build --crosstool_top=@llvm_toolchain//:toolchain --copt=-D_LIBCPP_ENABLE_NODISCARD
build --strip=never
build --experimental_cc_static_library

# largely from sorbet
build:debugsymbols --copt=-g3
build:debugsymbols --linkopt=-g3
build:debugsymbols --spawn_strategy=standalone
build:debugsymbols --genrule_strategy=standalone

build:disable-meshing --define disable_meshing=true
build:disable-randomization --define disable_randomization=true
build:shuffle-on-free --define shuffle_on_free=true

build:nolto --per_file_copt=.*@-fno-lto
build:nolto --linkopt=-fno-lto

build:modern-amd64 --copt=-mavx # --copt=-march=westmere
build:modern-amd64 --linkopt=-mavx # --linkopt=-march=westmere

build:modern-arm64 --copt=-mcpu=native
build:modern-arm64 --linkopt=-mcpu=native
